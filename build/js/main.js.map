{"version":3,"names":[],"mappings":"","sources":["main.js"],"sourcesContent":["function is_touch_device() {\n return (('ontouchstart' in window) || (navigator.MaxTouchPoints > 0) || navigator.msMaxTouchPoints > 0);\n}\n\nvar mobileGlobal, touchGlobal;\n\nif( /Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent) ) {\n document.body.classList.add(\"mobile\");\n mobileGlobal = true; \n}\n\nif(is_touch_device()) {\n  document.body.classList.add(\"touch\");\n  touchGlobal = true;\n}\n\nif ('addEventListener' in document) {\n    document.addEventListener('DOMContentLoaded', function() {\n        FastClick.attach(document.body);\n    }, false);\n}\n\nHyphenator_Loader.init({\n    \"ru\": \"automatically\"\n  },\n  \"js/Hyphenator.js\"\n);\n\n(function () {\n  function CustomEvent ( event, params ) {\n    params = params || { bubbles: false, cancelable: false, detail: undefined };\n    var evt = document.createEvent( 'CustomEvent' );\n    evt.initCustomEvent( event, params.bubbles, params.cancelable, params.detail );\n    return evt;\n   }\n\n  CustomEvent.prototype = window.Event.prototype;\n\n  window.CustomEvent = CustomEvent;\n})();\nif ('objectFit' in document.documentElement.style === false) {\n\tdocument.addEventListener('DOMContentLoaded', function () {\n\t\tArray.prototype.forEach.call(document.querySelectorAll('img[data-object-fit]'), function (image) {\n\t\t\t(image.runtimeStyle || image.style).background = 'url(\"' + image.src + '\") no-repeat 50%/' + (image.currentStyle ? image.currentStyle['object-fit'] : image.getAttribute('data-object-fit'));\n\n\t\t\timage.src = 'data:image/svg+xml,%3Csvg xmlns=\\'http://www.w3.org/2000/svg\\' width=\\'' + image.width + '\\' height=\\'' + image.height + '\\'%3E%3C/svg%3E';\n\t\t});\n\t});\n}\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var dropdown = document.querySelectorAll(\".dropdown\");\n  document.addEventListener(\"click\", closeDropdown);\n  document.addEventListener(\"touchstart\", closeDropdown);\n  \n  for(var i = 0; i < dropdown.length; i++) {\n    dropdown[i].addEventListener(\"click\", toggleDropdown);    \n  }\n  \n});\n\nfunction toggleDropdown(e) {\n  var elem;  \n  var classList = Array.prototype.slice.call(e.target.classList, 0);\n  \n  if(classList.indexOf(\"dropdown\") !== -1) {\n    elem = e.target;    \n  } else {\n    elem = e.target.parentElement.parentNode;\n  }\n  \n  elem.classList.toggle(\"dropdown--open\");\n  var options = elem.children[0].children;\n  for(var i = 0; i < options.length; i++) {\n    options[i].addEventListener(\"click\", selectOption.bind(null, options[i]));\n  }\n}\n\nfunction closeDropdown(e) {\n  var classList = Array.prototype.slice.call(e.target.classList, 0);\n  var parentClassList = Array.prototype.slice.call(e.target.parentElement.parentNode.classList, 0);\n  \n  if(document.querySelector(\".dropdown--open\") && classList.indexOf(\"dropdown\") == -1 && parentClassList.indexOf(\"dropdown\") == -1) {\n    document.querySelector(\".dropdown--open\").classList.remove(\"dropdown--open\");\n  }\n  \n}\n\nfunction selectOption(elem) {  \n  var option = elem.parentElement.querySelectorAll(\".dropdown .dropdown__item--selected\");\n   \n  option[0].classList.remove(\"dropdown__item--selected\");\n  elem.classList.add(\"dropdown__item--selected\");\n  \n  var event = new CustomEvent(\"choose\", {\"detail\": elem});\n  elem.parentElement.parentElement.dispatchEvent(event);\n}\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var player = document.getElementById('video-player');\n  var control = document.querySelector('.video__controls-play');\n  var video = document.querySelector('.video__item');\n  var flag = false;\n  \n  if(!mobileGlobal) {\n    video.setAttribute(\"preload\", \"true\");\n  }\n \n  video.addEventListener(\"loadedmetadata\", function() {\n    var duration = Math.round(video.duration)/100;\n    document.querySelector('.video-section__duration').innerHTML = duration;\n  });\n  \n  player.addEventListener(\"click\", function() {\n    player.classList.add('video--played');\n    \n    flag = true;\n        \n    if(flag) {\n      video.play();\n    } \n    \n  });\n});\nvar popups;\nvar scrollButtonCount = 2;\nvar tabletSize = 768;\nvar desctopSize = 1280;  \nvar popupInner;\nvar heightArray;\n\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var carousel = document.getElementById(\"carousel\");\n  var popupsEl = document.getElementById(\"popups\");  \n  var carouselContent = document.querySelectorAll(\"#carousel-container .carousel__content\");\n  var popupContentBlock = document.querySelectorAll(\"#popup-container .carousel__content\");\n  popupInner = document.querySelector(\"#popups .carousel__inner\");\n  \n  var scrollButtonRight = document.querySelector(\".carousel__scroll-button--right\");\n  var scrollButtonLeft = document.querySelector(\".carousel__scroll-button--left\");\n \n  var scrollOffset, k;\n  if(window.innerWidth >= tabletSize && window.innerWidth < desctopSize) {\n    k = 2.5;\n  } else {\n    k = 3.2;\n  }  \n  \n  scrollOffset = parseInt(window.getComputedStyle(document.querySelector(\".medium-column5\"), null).width) * k;\n  \n  scrollButtonRight.addEventListener(\"click\", function(e) {    \n    var currentContent = outer.currentIndex;\n    var el = outer.panes[currentContent];\n    smooth_scroll_to(el, el.scrollLeft + scrollOffset, 500);\n  });\n  \n  scrollButtonLeft.addEventListener(\"click\", function(e) {\n    var currentContent = outer.currentIndex;\n    var el = outer.panes[currentContent];\n    smooth_scroll_to(el, el.scrollLeft - scrollOffset, 500);\n  });\n  \n  for(var i = 0; i < carouselContent.length; i++) {\n    carouselContent[i].addEventListener(\"scroll\", contentScroll);\n  }\n  \n  heightArray = [];\n  Array.prototype.forEach.call(popupContentBlock, function(content) {\n    heightArray.push(content.clientHeight);\n  });\n\n  if(window.innerWidth >= tabletSize) {\n    var outer = new HammerCarousel(carousel);\n    popups = new HammerCarousel(popupsEl);\n  } else {\n    var outer = new HammerCarousel(carousel, Hammer.DIRECTION_HORIZONTAL);\n    popups = new HammerCarousel(popupsEl, Hammer.DIRECTION_HORIZONTAL);\n  } \n  \n  var windowSize = {\n    x: window.innerWidth,\n    y: window.innerHeight\n  };\n  \n  window.addEventListener(\"resize\", function() {\n    if(windowSize.x !== window.innerWidth) {\n      var i = outer.currentIndex;\n      var j = popups.currentIndex;\n      \n      if(window.innerWidth >= tabletSize) {        \n        outer = new HammerCarousel(carousel);\n        popups = new HammerCarousel(popupsEl);\n      } else {\n        outer = new HammerCarousel(carousel, Hammer.DIRECTION_HORIZONTAL);\n        popups = new HammerCarousel(popupsEl, Hammer.DIRECTION_HORIZONTAL);\n      }\n      \n      HammerCarousel.prototype.show.apply(outer, [i, 0, true]);\n      document.getElementById(\"popups-overlay\").classList.add(\"no-animate\");\n      HammerCarousel.prototype.show.apply(popups, [j, 0, true]);\n      setTimeout(function() {\n        document.getElementById(\"popups-overlay\").classList.remove(\"no-animate\");\n      }, 0);\n      \n      heightArray = [];\n      Array.prototype.forEach.call(popupContentBlock, function(content) {\n        heightArray.push(content.clientHeight);\n      });\n      \n    }\n    \n    if(window.innerWidth >= tabletSize && window.innerWidth < desctopSize) {\n      k = 2.5;\n    } else {\n      k = 3.2;\n    }  \n  \n    scrollOffset = parseInt(window.getComputedStyle(document.querySelector(\".medium-column5\"), null).width) * k;\n    \n    windowSize.x = window.innerWidth;\n  });\n  \n  function contentScroll(e) {    \n    var elem = e.target;\n    addRemoveScrollButton(elem, elem.parentElement);\n  }\n  \n  var smooth_scroll_to = function(element, target, duration) {\n    target = Math.round(target);\n    duration = Math.round(duration);\n    if (duration < 0) {\n        return;\n    }\n    if (duration === 0) {\n        element.scrollLeft = target;\n        return scroll();\n    }\n\n    var start_time = Date.now();\n    var end_time = start_time + duration;\n\n    var start_top = element.scrollLeft;\n    var distance = target - start_top;\n\n    // based on http://en.wikipedia.org/wiki/Smoothstep\n    var smooth_step = function(start, end, point) {\n        if(point <= start) { return 0; }\n        if(point >= end) { return 1; }\n        var x = (point - start) / (end - start); // interpolation\n        return x*x*(3 - 2*x);\n    }\n    \n    function scroll() {\n        // This is to keep track of where the element's scrollLeft is\n        // supposed to be, based on what we're doing\n        var previous_top = element.scrollLeft;\n\n        // This is like a think function from a game loop\n        var scroll_frame = function() {\n            if(element.scrollLeft != previous_top) {\n                return;\n            }\n\n            // set the scrollLeft for this frame\n            var now = Date.now();\n            var point = smooth_step(start_time, end_time, now);\n            var frameTop = Math.round(start_top + (distance * point));\n            element.scrollLeft = frameTop;\n\n            // check if we're done!\n            if(now >= end_time) {\n                scroll();\n                return;\n            }\n\n            // If we were supposed to scroll but didn't, then we\n            // probably hit the limit, so consider it done; not\n            // interrupted.\n            if(element.scrollLeft === previous_top\n                && element.scrollLeft !== frameTop) {\n                scroll();\n                return;\n            }\n            previous_top = element.scrollLeft;\n\n            // schedule next frame for execution\n            setTimeout(scroll_frame, 0);\n        }\n\n        // boostrap the animation process\n        setTimeout(scroll_frame, 0);\n    }\n\n    return scroll();\n}\n  \n});\n\nfunction addRemoveScrollButton(elem, container) {\n    if(elem.clientWidth + elem.scrollLeft === elem.scrollWidth) {\n      container.classList.remove(\"carousel__container--start\");\n      container.classList.add(\"carousel__container--end\");\n    } else if(elem.scrollLeft === 0) {\n      container.classList.add(\"carousel__container--start\");\n      container.classList.remove(\"carousel__container--end\");\n    } else {      \n      container.classList.remove(\"carousel__container--start\");\n      container.classList.remove(\"carousel__container--end\");\n    }\n    \n    if(elem.clientWidth === elem.scrollWidth) {\n      container.classList.add(\"carousel__container--start\");\n      container.classList.add(\"carousel__container--end\");\n    }\n  }\n\n var reqAnimationFrame = (function () {\n    return window[Hammer.prefixed(window, \"requestAnimationFrame\")] || function (callback) {\n      setTimeout(callback, 1000 / 60);\n    };\n  })();\n\n function dirProp(direction, hProp, vProp) {\n    return (direction & Hammer.DIRECTION_HORIZONTAL) ? hProp : vProp;\n  }\n\n\n function HammerCarousel(container, direction) {\n    this.container = container.children[1].children[0];\n    this.tabs = container.children[0].children[0];\n    this.tabsContainer = container.children[0];\n    this.direction = direction; \n    this.currentIndex = 0;\n    \n    if(this.container.id == \"carousel-container\") {      \n      this.panes = Array.prototype.slice.apply(this.container.children, [0, length - scrollButtonCount]);      \n    } else {      \n      this.panes = Array.prototype.slice.call(this.container.children, 0);\n    }\n   \n    this.tabsOffset = ((this.tabs.clientWidth - 16 - window.innerWidth)/2);\n\n    var self = this;\n    this.tabs.addEventListener(\"click\", function(e) {\n      \n      carouselContent = self.panes;\n      e.preventDefault();\n      if (e.target.tagName !== \"A\") {\n        return;\n      }\n    \n      currentContent = e.target.getAttribute(\"data-tab\");\n    \n      if(self.currentIndex == 0) {\n        k = 1.75;\n        scrollOffset = parseInt(window.getComputedStyle(document.querySelector(\".medium-column5\"), null).width) * k;\n      }\n    \n      HammerCarousel.prototype.show.apply(self, [currentContent, 0, true]);\n    });    \n    \n    this.containerSize = this.container[dirProp(direction, \"offsetWidth\", \"offsetHeight\")];\n\n    this.hammer = new Hammer.Manager(this.container);\n    this.hammer.add(new Hammer.Pan({\n      direction: this.direction,\n      threshold: 10\n    }));\n    this.hammer.on(\"panstart panmove panend pancancel\", Hammer.bindFn(this.onPan, this));\n\n    this.show(this.currentIndex);\n  }\n\n  HammerCarousel.prototype = {\n   \n    show: function (showIndex, percent, animate) {\n      showIndex = Math.max(0, Math.min(showIndex, this.panes.length - 1));\n      percent = percent || 0;\n\n      Array.prototype.forEach.call(this.tabs.children, function(tab) {\n        if(tab.classList[1] == 'carousel__tab--active') {\n          tab.classList.remove(\"carousel__tab--active\");\n        };\n      });\n      this.tabs.children[showIndex].classList.add(\"carousel__tab--active\");\n     \n      var tabTransform, persentTab;\n      \n      var stopTabTransform;\n      if(this.container.id == \"popup-container\") {\n        stopTabTransform = 600;\n      } else {\n         stopTabTransform = 430;\n      }    \n            \n      if (window.innerWidth < stopTabTransform) {        \n        if (showIndex === 0) {\n          this.tabsContainer.classList.remove(\"carousel__tabs-container--end\");\n          this.tabsContainer.classList.add(\"carousel__tabs-container--start\");\n          \n          if(this.container.id == \"popup-container\") {\n            persentTab =  this.tabsOffset + 45; \n          } else {\n            persentTab = this.tabsOffset \n          }  \n          \n        } else if (showIndex === 1) {\n          this.tabsContainer.classList.remove(\"carousel__tabs-container--end\");\n          this.tabsContainer.classList.remove(\"carousel__tabs-container--start\");\n          persentTab = 0;         \n        } else if (showIndex === 2) {\n          this.tabsContainer.classList.remove(\"carousel__tabs-container--start\");\n          this.tabsContainer.classList.add(\"carousel__tabs-container--end\");           \n          \n          if(this.container.id == \"popup-container\") {\n            persentTab = - (this.tabsOffset + 10); \n          } else {\n            persentTab = - (this.tabsOffset + 20);\n          }\n          \n        }\n        \n      } else {\n        persentTab = 0;\n      }\n      \n      if(window.innerWidth < 1024) {\n        tabTransform = 'translate3d('+(persentTab - this.tabs.clientWidth/2)+'px, 0, 0)';\n      } else {\n        tabTransform = 'translate3d(0px, 0, 0)';\n      }\n      \n      this.tabs.style.transform = tabTransform;\n      this.tabs.style.mozTransform = tabTransform;\n      this.tabs.style.webkitTransform = tabTransform;\n      \n      var className = this.container.className;\n        if (animate) {\n          if (className.indexOf(\"animate\") === -1) {\n            this.container.className += \" animate\";\n          }\n        } else {\n          if (className.indexOf(\"animate\") !== -1) {\n            this.container.className = className.replace(\"animate\", \"\").trim();\n          }\n        }\n      \n      var paneIndex, pos, translate;\n      \n      //if(window.innerWidth < desctopSize) {\n        if(this.container.id == \"popup-container\") {\n          popupInner.style.height = heightArray[showIndex] + 50 + 'px';\n        } \n      //}\n      \n      if (window.innerWidth < tabletSize) {      \n        for (paneIndex = 0; paneIndex < this.panes.length; paneIndex++) {\n          pos = (this.containerSize / 100) * (((paneIndex - showIndex) * 100) + percent);\n          \n          if (this.direction & Hammer.DIRECTION_HORIZONTAL) {\n            translate = \"translate3d(\" + pos + \"px, 0, 0)\";\n          } else {\n            translate = \"translate3d(0, \" + pos + \"px, 0)\";\n          }\n          this.panes[paneIndex].style.transform = translate;\n          this.panes[paneIndex].style.mozTransform = translate;\n          this.panes[paneIndex].style.webkitTransform = translate;          \n        }\n        \n      } else {\n        for (paneIndex = 0; paneIndex < this.panes.length; paneIndex++) {\n          translate = \"translate3d(0, 0, 0)\";\n          this.panes[paneIndex].style.transform = translate;\n          this.panes[paneIndex].style.mozTransform = translate;\n          this.panes[paneIndex].style.webkitTransform = translate;\n        }\n        this.panes.forEach(function(pane) {\n          if(pane.classList[1] == 'carousel__content--active') {\n            pane.classList.remove(\"carousel__content--active\");\n          }\n        });\n        addRemoveScrollButton(this.panes[showIndex], this.container);    \n        this.panes[showIndex].classList.add(\"carousel__content--active\");\n      }\n\n      this.currentIndex = showIndex;\n    },\n    \n    onPan: function (ev) {\n      if(ev.pointers[0].type !== undefined) {\n        return;\n      }\n      if (window.innerWidth < tabletSize) {\n       \n        var delta = dirProp(this.direction, ev.deltaX, ev.deltaY);\n        var percent = (100 / this.containerSize) * delta;\n        var animate = false;\n\n        if (ev.type == \"panend\" || ev.type == \"pancancel\") {\n          if (Math.abs(percent) > 20 && ev.type == \"panend\") {\n            this.currentIndex += (percent < 0) ? 1 : -1;\n          }\n          percent = 0;\n          animate = true;\n        }\n        if(Math.abs(ev.deltaY) > 15) {\n          percent = 0;\n          animate = true;\n        }\n        this.show(this.currentIndex, percent, animate);\n      }\n\n    }\n  };\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  var elements = document.querySelectorAll(\"*[data-popups]\");\n  popupOverlay = document.getElementById(\"popups-overlay\");\n  popupContact = document.getElementById(\"contact-popup\");\n  var overlays = document.querySelectorAll(\".popups-overlay\");\n\n  Array.prototype.forEach.call(elements, function(el) {\n    if(el.getAttribute(\"data-popup-contact\")) {\n      el.addEventListener(\"click\", openContactsPopup);\n    } else {\n      el.addEventListener(\"click\", openPopup);\n    }\n\n  });\n\n  Array.prototype.forEach.call(overlays, function(overlay) {\n    overlay.addEventListener(\"click\", closePopup);\n  });\n\n  popupOverlay.children[0].addEventListener(\"scroll\", function(e) {\n    scrollPosition = this.scrollTop;\n  });\n\n  var closers = document.querySelectorAll(\".popups__closer\");\n\n  Array.prototype.forEach.call(closers, function(closer){\n    closer.addEventListener(\"click\", closeOnClick);\n  });\n\n\n  if(window.innerWidth < desctopSize) {\n    mainElem = document.getElementById(\"wrapper\");\n  } else {\n    mainElem = document.body || document.documentElement;\n  }\n\n  var windowSizePopup = {\n    x: window.innerWidth,\n    y: window.innerHeight\n  };\n\n  window.addEventListener(\"resize\", function () {\n    if (windowSizePopup.x !== window.innerWidth) {\n      if (window.innerWidth < desctopSize) {\n        mainElem = document.getElementById(\"wrapper\");\n      } else {\n        mainElem = document.body || document.documentElement;\n      }\n    }\n\n    if(windowSizePopup.x < tabletSize && window.innerWidth > tabletSize && popups.currentIndex === 2) {\n      closeOnClick()\n    }\n\n    if(windowSizePopup.x < desctopSize && window.innerWidth > desctopSize && popups.currentIndex === 0) {\n      closeOnClick();\n    }\n\n    windowSizePopup.x = window.innerWidth;\n  });\n\n});\nvar popupOverlay;\nvar scrollTopOffset;\nvar flag = false;\nvar donateCount, donatePeriod, scrollPosition;\nvar mainElem;\nvar popupContact;\n\nfunction closePopup(e) {\n  if(e.target !== this) {\n    return false;\n  }\n  closeOnClick();\n}\n\nfunction closeOnClick() {\n  if(flag === false) {\n      mainElem.classList.remove(\"ov-hidden\");\n  }\n  document.documentElement.scrollTop = scrollTopOffset;\n  document.body.scrollTop = scrollTopOffset;\n  popupOverlay.classList.remove(\"popups-overlay--open\");\n  popupContact.classList.remove(\"popups-overlay--open\");\n}\n\nfunction openPopup(e) {\n  if(e.target.offsetParent.id.indexOf(\"popup\") !== -1) {\n    flag = true;\n  } else {\n    flag = false;\n  }\n  var btn = e.currentTarget;\n  var popupNumber = btn.getAttribute(\"data-popups\");\n  popupOverlay.classList.add(\"no-animate\");\n  HammerCarousel.prototype.show.apply(popups, [popupNumber, 0, true]);\n\n  if(popupNumber == 1) {\n    donateCount = btn.getAttribute(\"data-count\");\n    donatePeriod = btn.getAttribute(\"data-period\");\n\n    if(donateCount) {\n      summ.value = donateCount;\n    }\n\n    if(donatePeriod) {\n      selectOption(formDropdown.querySelector(\"*[data-value='\"+donatePeriod+\"']\"));\n    }\n\n    var substr;\n    if(window.innerWidth < tabletSize) {\n      substr = \"/мес\";\n    } else {\n      substr = \" в месяц\";\n    }\n\n    if(donatePeriod && donateCount) {\n      finalCount.innerHTML = donateCount+'&#8381;'+(donatePeriod == 'monthly'?substr:'');\n    }\n\n  }\n\n  scrollTopOffset = document.body.scrollTop || document.documentElement.scrollTop;\n  mainElem.classList.add(\"ov-hidden\");\n  popupOverlay.classList.add(\"popups-overlay--open\");\n  popupOverlay.classList.remove(\"no-animate\");\n}\n\nfunction openContactsPopup(e) {\n  if(window.innerWidth < desctopSize) {\n    openPopup(e);\n  } else {\n    popupContact.classList.add(\"popups-overlay--open\");\n    mainElem.classList.add(\"ov-hidden\");\n    scrollTopOffset = document.body.scrollTop || document.documentElement.scrollTop;\n  }\n}\nvar summ,\n    formDropdown,\n    finalCount,\n    btnPeriod;\n\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  var cartNumberInput = document.getElementById(\"cc-number\");\n  cartNumberInput.addEventListener(\"keyup\", function() {\n    this.value = cc_format(this);\n  });\n\n  cartNumberInput.addEventListener(\"blur\", function() {\n    this.value = cc_format(this);\n    if(validateEmpty(this.value, validateLengthInRange, 13, 19) === false) {\n      addRemoveErrorState('add', this, 'Пожалуйста, введите корректный номер карты.');\n    } else {\n      addRemoveErrorState('remove', this, 'Информация передается по защищенному соединению');\n    }\n    detectCard(this);\n  });\n\n  summ = document.getElementById(\"cc-summ\");\n  var month = document.getElementById(\"cc-month\");\n  var year = document.getElementById(\"cc-year\");\n  var cvv = document.getElementById(\"cc-cvv\");\n  var name = document.getElementById(\"cc-name\");\n  var email = document.getElementById(\"cc-email\");\n  formDropdown = document.getElementById(\"cc-dropdown\");\n  finalCount = document.getElementById(\"final-count\");\n  var checkbox = document.getElementById(\"cc-monthly\");\n\n  summ.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, true);\n  });\n\n  summ.addEventListener(\"blur\", function() {\n    this.value = sanitizeValue(this.value, true);\n    changeBtnInnerText(this.value);\n  });\n\n  month.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, true);\n  });\n\n  month.addEventListener(\"blur\", function() {\n    this.value = sanitizeValue(this.value, true);\n    if(validateEmpty(this.value, validateInRange, 1, 12) === false) {\n      addRemoveErrorState('add', this, 'Пожалуйста, введите корректный месяц.');\n    } else {\n      addRemoveErrorState('remove', this, '');\n    }\n  });\n\n  year.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, true);\n  });\n\n  year.addEventListener(\"blur\", function() {\n    this.value = sanitizeValue(this.value, true);\n    if(validateEmpty(this.value, validateYear) == false) {\n      addRemoveErrorState('add', this, 'Пожалуйста, введите корректный год.');\n    } else {\n      addRemoveErrorState('remove', this, '');\n    }\n  });\n\n  cvv.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, true);\n  });\n\n  cvv.addEventListener(\"blur\", function() {\n    this.value = sanitizeValue(this.value, true);\n    if(validateEmpty(this.value, validateLength, 3) == false) {\n      addRemoveErrorState('add', this, 'Пожалуйста, введите корректный код CVV.');\n    } else {\n      addRemoveErrorState('remove', this, '');\n    }\n  });\n\n  name.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, false, true);\n  });\n\n  name.addEventListener(\"blur\", function() {\n    this.value = sanitizeValue(this.value, false, true);\n  });\n\n  email.addEventListener(\"blur\", function() {\n    if(validateEmpty(this.value, validateEmail) == false) {\n      addRemoveErrorState('add', this, 'Пожалуйста, введите корректный адрес электронной почты.');\n    } else {\n      addRemoveErrorState('remove', this, 'Мы вышлем квитанцию Вам на электронную почту. Никакого спама, обещаем.');\n    }\n  });\n\n  formDropdown.addEventListener(\"choose\", function(e) {\n    btnPeriod = e.detail.getAttribute(\"data-value\");\n    changeBtnInnerText(summ.value, e.detail.getAttribute(\"data-value\"));\n    if(btnPeriod == 'once') {\n      checkbox.checked = false;\n    } else {\n      checkbox.checked = true;\n    }\n\n  });\n\n  checkbox.addEventListener(\"change\", function() {\n    if(this.checked) {\n      changeBtnInnerText(summ.value, 'monthly');\n      selectOption(formDropdown.querySelector(\"*[data-value='monthly']\"));\n    } else {\n      changeBtnInnerText(summ.value, 'once');\n      selectOption(formDropdown.querySelector(\"*[data-value='once']\"));\n    }\n  });\n\n});\n\nfunction cc_format(el) {\n  var v = el.value.replace(/\\s+/g, '').replace(/[^-0-9]/gim,'').replace(\"-\", \"\");\n\n  var parts = [];\n  var k;\n  if(v.length <= 16) {\n    for (i = 0, len = v.length; i < len; i += 4) {\n      parts.push(v.substring(i, i + 4));\n    }\n  } else {\n    parts.push(v.substring(0, 8));\n    parts.push(v.substring(8, v.length));\n  }\n\n  if (parts.length) {\n    return parts.join(' ');\n  } else {\n    return v;\n  }\n}\n\nvar cards = [\n  {name: \"AmericanExpress\", firstNumber: [34, 37], numberLength: [15]},\n  {name: \"MasterCard\", firstNumber: [51, 52, 53, 54, 55], numberLength: [16, 17, 18, 19]},\n  {name: \"Visa\", firstNumber: [4], numberLength: [13, 14, 15, 16]},\n  {name: \"Maestro\", firstNumber: [5018, 5020, 5038, 5893, 6304, 6759, 6761, 6762, 6763], numberLength: [16, 17, 18, 19]}\n];\n\nfunction detectCard(el) {\n  value = el.value.replace(/\\s+/g, \"\");\n\n  if(value.length < 13 || value.length > 19) {\n    return;\n  }\n  el.classList.remove(\"input-block__input--error\");\n  var filtredLengthCards = [];\n  cards.forEach(function(card) {\n    if(card.numberLength.indexOf(value.length) !== -1) {\n      filtredLengthCards.push(card);\n    }\n  });\n\n  var cardName;\n  filtredLengthCards.forEach(function(card) {\n    for(var i = 1; i <= 4; i++) {\n      if(card.firstNumber.indexOf(value.substring(0, i)|0) !== -1) {\n        cardName = card.name;\n        break;\n      }\n    }\n  });\n\n  if(cardName) {\n    document.querySelector(\".donate-form__card[value='\"+cardName+\"']\").setAttribute(\"checked\", true);\n    addRemoveErrorState('remove', el, '');\n  } else {\n    addRemoveErrorState('add', el, 'Пожалуйста, введите корректный номер карты.');\n  }\n\n}\n\nfunction validateEmail(value) {\n  if(/^[-\\w.]+@([A-z0-9][-A-z0-9]+\\.)+[A-z]{2,10}$/.test(value) === false) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nfunction validateEmpty(value, validateFunction) {\n  if(value === '') {\n    return false;\n  } else {\n    var arg = Array.prototype.slice.call(arguments, 2);\n    arg.unshift(value);\n    return validateFunction.apply(null, arg);\n  }\n}\n\nfunction sanitizeValue(value, number, name) {\n  var newValue = '';\n  if(number) {\n    newValue = value.replace(/\\s+/g, '').replace(/[^-0-9]/gim,'').replace(\"-\", \"\")\n  } else if(name) {\n    newValue = value.replace(/[^a-zA-Z.-\\s]/g, '');\n  }\n  return newValue;\n}\n\nfunction validateLength(value, length) {\n  if(value.length < length) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nfunction validateYear(value) {\n  if(value.length < 4) {\n    return false;\n  } else {\n    var now = new Date();\n    if(value < now.getFullYear() ) {\n      return false;\n    } else {\n      return true;\n    }\n  }\n}\n\nfunction validateInRange(value, min, max) {\n  value = value|0;\n  if(value < min || value > max) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nfunction validateLengthInRange(value, min, max) {\n  value = value.replace(/\\s+/g, \"\");\n  if(value.length < min || value.length > max) {\n    return false;\n  } else {\n    return true;\n  }\n}\n\nfunction addRemoveErrorState(flag, el, text) {\n  if(flag == 'add') {\n    el.classList.add(\"input-block__input--error\");\n  } else if(flag == 'remove') {\n    el.classList.remove(\"input-block__input--error\");\n  }\n  if(el.parentElement.nextElementSibling && el.parentElement.nextElementSibling.nodeName == 'P') {\n    el.parentElement.nextElementSibling.innerHTML = text;\n  } else {\n    document.getElementById(\"own-error-text\").innerHTML = text;\n  }\n}\n\nfunction changeBtnInnerText(count, period) {\n  count = count;\n  period = period;\n\n  var substr;\n  if(window.innerWidth < tabletSize) {\n    substr = \"/мес\";\n  } else {\n    substr = \" в месяц\";\n  }\n  finalCount.innerHTML = count+'&#8381;'+(period == 'monthly'?substr:'');\n}\ndocument.addEventListener(\"DOMContentLoaded\", function() {\n  var links = document.querySelectorAll(\"*[data-popup]\");\n  Array.prototype.forEach.call(links, function(link) {\n    link.addEventListener(\"click\", openRehabPopup.bind(null, link));\n  });\n  \n  var backButtons = document.querySelectorAll(\".rehub-popup__back\");\n  Array.prototype.forEach.call(backButtons, function(button) {\n    button.addEventListener(\"click\", closeRehabPopup);\n  });\n  \n});\n\nvar scrollTopOffsetRehab;\n\nfunction openRehabPopup(link, event) {\n  event.preventDefault();  \n  scrollTopOffsetRehab = document.body.scrollTop || document.documentElement.scrollTop;\n  setTimeout( function() {\n    document.getElementById(\"wrapper\").classList.add(\"ov-hidden\"); \n  }, 300);\n  var popup = document.getElementById(link.getAttribute(\"href\"));\n  popup.classList.add(\"rehub-popup--open\");\n}\n\nfunction closeRehabPopup(event) {\n  event.preventDefault();\n  document.getElementById(\"wrapper\").classList.remove(\"ov-hidden\");\n  document.body.scrollTop = scrollTopOffsetRehab; \n  document.documentElement.scrollTop = scrollTopOffsetRehab;\n  event.target.parentElement.parentElement.parentElement.parentElement.parentElement.classList.remove(\"rehub-popup--open\");\n}\ndocument.addEventListener(\"DOMContentLoaded\", function () {\n  var heroBtn = document.getElementById(\"hero-btn\");\n  document.getElementById(\"hero-dropdown\").addEventListener(\"choose\", function(e) {\n    heroBtn.setAttribute(\"data-period\", e.detail.getAttribute(\"data-value\"));\n  })\n  \n  var heroInput = document.getElementById(\"hero-input\");\n  heroInput.addEventListener(\"change\", function(e){\n    heroBtn.setAttribute(\"data-count\", e.target.value);\n  });\n  \n  heroInput.addEventListener(\"keyup\", function() {\n    this.value = sanitizeValue(this.value, true);   \n  });\n  \n});"],"file":"main.js"}